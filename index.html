<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Réservation</title>
  <style>
    :root {
      --font-family: 'Futura', sans-serif;
      --text-color: #b20000;
      --bg-color: #f1ede2;
      --strip-height: 20vh;
      --strip-padding: 1rem;
      --text-size: clamp(8vh, 10vw, 18vh);
      --control-gap: 0.5rem;
      --transition-duration: 0.4s;
      --button-box: 18vh;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body, html {
      margin: 0; padding: 0 2vw; height: 100%; background: var(--bg-color);
      font-family: var(--font-family); color: var(--text-color);
    }
    #reservation {
      position: absolute; top:50%; left:50%; transform: translate(-50%,-50%);
      width: 100%; height: var(--strip-height);
      display: flex; align-items: center; padding: 0 var(--strip-padding);
      background: var(--bg-color);
      overflow-x: auto;
    }
    .step {
      position: absolute; top:0; left:0;
      width:100%; height:100%; display:flex; align-items:center;
      opacity:0; visibility:hidden;
      transition:opacity var(--transition-duration);
      gap: var(--control-gap);
      justify-content: flex-start;
      pointer-events: none;
    }
    .step.active { opacity:1; visibility:visible; pointer-events: auto; }
    .typer, .invisible-input {
      font-size: var(--text-size); white-space:nowrap; overflow:hidden;
      height: var(--button-box); line-height: var(--button-box);
      border-right:2px solid var(--text-color);
      display:flex; align-items:center; justify-content:center;
      flex:1;
      pointer-events:none;
    }
    .invisible-input {
      position:absolute; left:0; top:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      opacity: 0; visibility:hidden;
      transition: opacity var(--transition-duration);
    }
    .text-input {
      position:absolute; left:0; top:0; width:100%; height:100%;
      background: transparent; color: var(--text-color);
      font-family: var(--font-family); font-size:clamp(4vh,4vw,var(--text-size));
      line-height: var(--button-box);
      border: none; border-right: 2px solid var(--text-color); outline: none;
      opacity: 0; visibility:hidden;
      transition: opacity var(--transition-duration);
      display:flex; align-items:center; justify-content:center;
      text-align:center;
    }
    .text-input::placeholder { color: var(--text-color); opacity: 0.6; }
    .name-fields {
      display:flex;
      justify-content:center;
      gap: 15px;
      width:100%;
    }
    #step6 .text-input {
      position: static;
      opacity: 1;
      visibility: visible;
      width: calc(20% - 7.5px);
      border-right: none;
    }
    #step6 { justify-content: center; }
    #step8 { justify-content: center; }
    .controls {
      position:absolute;
      left:0; top:0; width:100%; height:100%;
      display:flex; align-items:center; gap:var(--control-gap);
      justify-content:center;
      visibility:hidden;
    }
    .controls > * {
      background:transparent; color:var(--text-color);
      font-family:var(--font-family);
      font-size:clamp(4vh,4vw,var(--text-size));
      height:var(--button-box); opacity:0;
      transition:opacity var(--transition-duration);
      display:flex; align-items:center; justify-content:center;
    }
    .controls button { border:2px solid var(--text-color); padding:0 1rem; }
    #controls2 button,
    #controls3 button,
    #controls4 button,
    #controls5 button { width: var(--button-box); padding: 0; }
    #controls5 button { font-size: calc(var(--text-size) * 0.25); }
    .controls button.selected { background:var(--text-color); color:var(--bg-color); }
    .or {
      padding: 0 0.5rem;
      font-size: clamp(4vh,4vw,var(--text-size));
    }
    .controls input[type='number'] {
      border: none; width:4ch; background: transparent; color: var(--text-color);
      font-size:clamp(4vh,4vw,var(--text-size)); text-align:center;
      height:var(--button-box); line-height:var(--button-box);
      display:flex; align-items:center; justify-content:center;
    }
    .controls input[type='number']::-webkit-inner-spin-button,
    .controls input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    .controls input[type='number'] { -moz-appearance: textfield; }
    #day-num { width: calc(var(--button-box) * 0.8); }
    #prev-day, #next-day, #prev-month, #next-month {
      width: calc(var(--button-box) * 0.5);
      height: calc(var(--button-box) * 0.5);
      line-height: calc(var(--button-box) * 0.5);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #month-name {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: calc(var(--button-box) * 2.5);
      height: var(--button-box);
      line-height: var(--button-box);
      text-align: center;
    }
    #controls5 { overflow-x:auto; scrollbar-width:thin; scrollbar-color:var(--text-color) transparent; }
    #controls5::-webkit-scrollbar { height:0.5rem; }
    #controls5::-webkit-scrollbar-thumb { background:var(--text-color); border-radius:0.25rem; }
    .arrow {
      position:absolute; right:var(--strip-padding);
      top:50%; transform:translateY(-50%);
      background:transparent; border:2px solid var(--text-color);
      color:var(--text-color);
      font-family:var(--font-family);
      font-size:calc(var(--text-size) * 0.25);
      height:calc(var(--button-box) * 0.35);
      width:calc(var(--button-box) * 0.35);
      line-height:calc(var(--button-box) * 0.35);
      padding:0;
      box-sizing:border-box;
      opacity:0; transition:opacity var(--transition-duration);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
    }
    .arrow svg { display:none; }
    .back {
      position: absolute;
      left: var(--strip-padding);
      top: var(--strip-padding);
      width: calc(var(--button-box) * 0.25);
      height: calc(var(--button-box) * 0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--text-color);
      background: transparent;
      color: var(--text-color);
      font-size: calc(var(--text-size) * 0.25);
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--transition-duration);
      pointer-events: none;
    }
    #startStep { justify-content: center; }

    #startBtn {
      font-size: var(--text-size);
      background: transparent;
      color: var(--text-color);
      border: none;
      cursor: pointer;
      transition: opacity var(--transition-duration);
      font-family: var(--font-family);
    }
    #startBtn.fade { opacity: 0; }

    .ok-btn {
      font-size: calc(var(--text-size) * 0.5);
      background: transparent;
      color: var(--text-color);
      border: 2px solid var(--text-color);
      cursor: pointer;
      font-family: var(--font-family);
      opacity: 0;
      transition: opacity var(--transition-duration);
      width: calc(var(--button-box) * 0.5);
      height: calc(var(--button-box) * 0.5);
      padding: 0;
      position: absolute;
      right: 15px;
      bottom: 15px;
      box-sizing: border-box;
      }

    .confirm {
      opacity: 0;
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
    }
    .custom-input {
      position: relative;
      border: 2px solid var(--text-color);
      width: var(--button-box);
      height: var(--button-box);
      transition: width var(--transition-duration);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--control-gap);
      opacity: 1;
    }
    .custom-input input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text-color);
      text-align: center;
      font-size: clamp(4vh,4vw,var(--text-size));
      font-family: var(--font-family);
      font-weight: normal;
      height: var(--button-box);
      outline: none;
    }
    .custom-input .arrow {
      position: static;
      transform: none;
      top: auto;
      right: auto;
      margin-left: 10px;
      width: calc(var(--button-box) * 0.25);
      height: calc(var(--button-box) * 0.25);
      padding: 0;
    }
    button.disabled {
      opacity: 0.3;
      pointer-events: none;
    }
    #summaryTyper {
      overflow: visible;
      width: fit-content;
    }
    #thanksTyper {
      font-size: calc(var(--text-size) * 0.5);
    }
    .scroll {
      white-space: nowrap;
      display: inline-block;
      animation: slideLeft 10s linear forwards;
      pointer-events: none;
    }
    @keyframes slideLeft {
      from { transform: translateX(100vw); }
      to { transform: translateX(calc(-100% - 100vw)); }
    }
  </style>
</head>
<body>
  <div id="reservation">
    <button id="backBtn" class="back">&#8592;</button>
    <div class="step" id="startStep">
      <button id="startBtn">Réserver</button>
    </div>
    <div class="step" data-question="Réserver:" id="step1">
      <span class="typer"></span>
      <div class="controls" id="controls1">
        <button data-value="Aux Dés Calés 17">Aux Dés Calés 17</button>
        <button data-value="Aux Dés Calés 18">Aux Dés Calés 18</button>
        <button data-value="Au Détour">Au Détour</button>
      </div>
    </div>
    <div class="step" data-question="Vous serez combien ?" id="step2">
      <span class="typer"></span>
      <div class="controls" id="controls2"></div>
    </div>
    <div class="step" data-question="Quel Jour ?" id="step3">
      <span class="typer"></span>
      <div class="controls" id="controls3">
        <button id="prev-day">‹</button>
        <input type="number" id="day-num" min="1" max="31" value="1">
        <button id="next-day">›</button>
        <button id="prev-month">‹</button>
        <span id="month-name"></span>
        <button id="next-month">›</button>
      </div>
      <button class="arrow" id="arrow3">OK</button>
    </div>
    <div class="step" data-question="Quelle heure ?" id="step4">
      <span class="typer"></span>
      <div class="controls" id="controls4">
        <button data-value="Midi">Midi</button>
        <span class="or">ou</span>
        <button data-value="Soir">Soir</button>
      </div>
    </div>
    <div class="step" id="step5">
      <div class="controls" id="controls5"></div>
    </div>
    <div class="step" data-question="À quel nom ?" id="step6">
      <span class="typer"></span>
      <div class="name-fields">
        <input type="text" id="lastname-input" class="text-input" placeholder="Nom">
        <input type="text" id="firstname-input" class="text-input" placeholder="Prénom">
      </div>
      <button class="arrow" id="arrow6">OK</button>
    </div>
    <div class="step" id="step7">
      <span class="typer" id="summaryTyper"></span>
    </div>
    <div class="step" data-question="Une info à rajouter?" id="step8">
      <span class="typer"></span>
      <input type="text" id="info-input" class="text-input" placeholder="Une table en terrasse...">
      <button class="arrow" id="arrow8">OK</button>
      <button id="okBtn" class="ok-btn">Tout est OK!</button>
    </div>
    <div class="step" id="step9">
      <span class="typer" id="thanksTyper"></span>
    </div>
  </div>
  <script>
    const reservation = {};
    const reservationDiv = document.getElementById('reservation');
    const steps = Array.from(document.querySelectorAll('.step'));
    const backBtn = document.getElementById('backBtn');
    let idx = 0;

    function typeText(el, text, cb) {
      el.textContent = '';
      let i = 0;
      el.style.borderRight = '2px solid var(--text-color)';
      const iv = setInterval(() => {
        el.textContent += text.charAt(i);
        i++;
        if (i > text.length) {
          clearInterval(iv);
          cb && cb();
        }
      }, 50);
    }

    function typeOut(el, cb) {
      let i = el.textContent.length;
      el.style.borderRight = '2px solid var(--text-color)';
      const iv = setInterval(() => {
        el.textContent = el.textContent.slice(0, --i);
        if (i <= 0) {
          clearInterval(iv);
          el.style.borderRight = 'none';
          cb && cb();
        }
      }, 50);
    }

    function fadeInSeq(container, cb) {
      const items = Array.from(container.children);
      items.forEach((it, i) => setTimeout(() => it.style.opacity = '1', i * 200));
      setTimeout(cb, items.length * 200);
    }

    function fadeOutSeq(container, cb) {
      const items = Array.from(container.children);
      items.forEach((it, i) => setTimeout(() => it.style.opacity = '0', i * 50));
      setTimeout(() => { container.style.visibility = 'hidden'; cb && cb(); }, items.length * 50);
    }

  function showStep(i) {
     steps.forEach(s => s.classList.remove('active'));
     const s = steps[i];
     s.classList.add('active');
     updateBackButton();
     const summary = document.getElementById('summaryTyper');
      if (summary) {
        summary.classList.remove('scroll');
        summary.style.transform = 'none';
      }
      reservationDiv.scrollLeft = 0;
      if (s.id === 'startStep') return;
      const question = s.getAttribute('data-question');
      const typer = s.querySelector('.typer');
      if (s.id === 'step9') {
        typeText(document.getElementById('thanksTyper'), 'Merci pour votre réservation!', () => {
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        });
        return;
      }
      const controls = s.querySelector('.controls');
      const arrow = s.querySelector('.arrow');
      if (controls) {
        controls.style.visibility = 'hidden';
        controls.querySelectorAll('*').forEach(el => el.style.opacity = '0');
      }
      if (arrow) arrow.style.opacity = '0';


      if (s.id === 'step1') {
        if (typer) {
          typer.style.opacity = '0';
          typer.style.borderRight = 'none';
        }
        if (controls) {
          controls.style.visibility = 'visible';
          fadeInSeq(controls, () => { if (arrow) arrow.style.opacity = '1'; });
        }
        return;
      }

      if (s.id === 'step5') {
        if (controls) {
          loadTimes();
          controls.style.visibility = 'visible';
          fadeInSeq(controls, () => { if (arrow) arrow.style.opacity = '1'; });
        }
        return;
      }

      if (s.id === 'step7') {
        reservationDiv.style.overflow = 'visible';
        const sum = `Réservation ${reservation.restaurant} pour ${reservation.people} personnes le ${reservation.date} à ${reservation.time} au nom de ${reservation.lastname}, ${reservation.firstname}`;
        const t = document.getElementById('summaryTyper');
        t.textContent = sum;
        t.classList.add('scroll');
        t.addEventListener('animationend', () => next(), {once:true});
        return;
      } else {
        reservationDiv.style.overflowX = 'auto';
      }

      if (typer && question) {
        typer.style.opacity = '1';
        typeText(typer, question, () => {
          setTimeout(() => {
            typeOut(typer, () => {
              typer.style.opacity = '0';
              if (controls) {
                controls.style.visibility = 'visible';
                fadeInSeq(controls, () => {
                  if (arrow) arrow.style.opacity = '1';
                });
              } else if (s.id === 'step6') {
                initNameStep();
                if (arrow) arrow.style.opacity = '1';
              } else if (s.id === 'step8') {
                initInfoStep();
              }
            });
          }, 3000);
        });
      }
      updateBackButton();
  }

  function updateBackButton() {
    const stepId = steps[idx].id;
    const okVisible = document.getElementById('okBtn').style.opacity === '1';
    if (stepId === 'startStep' || stepId === 'step9' || (stepId === 'step8' && okVisible)) {
      backBtn.style.opacity = '0';
      backBtn.style.pointerEvents = 'none';
    } else {
      backBtn.style.opacity = '1';
      backBtn.style.pointerEvents = 'auto';
    }
  }

  function resetStepData(stepIdx) {
    switch (stepIdx) {
      case 1:
        delete reservation.restaurant;
        document.querySelectorAll('#controls1 button').forEach(b => {
          b.classList.remove('selected');
          b.style.opacity = '1';
        });
        break;
      case 2:
        delete reservation.people;
        createControls2();
        break;
      case 3:
        delete reservation.date;
        dayNumEl.value = now.getDate();
        m = now.getMonth();
        monthNameEl.textContent = months[m];
        updateDateArrows();
        break;
      case 4:
        delete reservation.period;
        controls4.querySelectorAll('button').forEach(b => {
          b.classList.remove('selected');
          b.style.opacity = '1';
        });
        break;
      case 5:
        delete reservation.time;
        c5.innerHTML = '';
        break;
      case 6:
        delete reservation.lastname;
        delete reservation.firstname;
        nameInit = false;
        document.getElementById('lastname-input').value = '';
        document.getElementById('firstname-input').value = '';
        break;
      case 8:
        delete reservation.comment;
        document.getElementById('info-input').value = '';
        document.getElementById('okBtn').style.opacity = '0';
        document.getElementById('arrow8').style.opacity = '1';
        break;
      default:
        break;
    }
  }

    function next() {
      const current = steps[idx];
      const controls = current.querySelector('.controls');
      const arrow = current.querySelector('.arrow');
      if (controls) fadeOutSeq(controls, () => {});
      if (arrow) arrow.style.opacity = '0';
      setTimeout(() => {
        idx++;
        showStep(idx);
      }, 400);
    }

    // Step1
    document.querySelectorAll('#controls1 button').forEach(btn => btn.addEventListener('click', e => {
      [...document.querySelectorAll('#controls1 button')].forEach(b => b.style.opacity = '0');
      btn.classList.add('selected');
      reservation.restaurant = btn.dataset.value;
      setTimeout(next, 400);
    }));

    // Step2
    const c2 = document.getElementById('controls2');
    function createControls2() {
      c2.innerHTML = '';
      for (let i = 1; i <= 7; i++) {
        const b = document.createElement('button');
        b.textContent = i;
        b.addEventListener('click', () => {
          Array.from(c2.children).forEach(ch => ch.style.opacity = '0');
          b.classList.add('selected');
          reservation.people = i;
          setTimeout(next, 400);
        });
        c2.appendChild(b);
      }
      const plus = document.createElement('button');
      plus.textContent = '+';
      plus.addEventListener('click', () => {
        const wrapper = document.createElement('div');
        wrapper.className = 'custom-input';
        wrapper.style.opacity = '1';
        const input = document.createElement('input');
        input.type = 'number';
        wrapper.appendChild(input);
        const confirm = document.createElement('button');
        confirm.className = 'arrow';
        confirm.textContent = 'OK';
        wrapper.appendChild(confirm);
        c2.replaceChild(wrapper, plus);
        setTimeout(() => {
          wrapper.style.width = 'calc(var(--button-box)*2)';
          confirm.style.opacity = '1';
        }, 10);
        input.focus();
        confirm.onclick = () => {
          const v = parseInt(input.value, 10);
          if (!isNaN(v) && v > 0) {
            reservation.people = v;
            next();
          }
        };
      });
      c2.appendChild(plus);
    }
    createControls2();

    // Step3 day/month
    const months = ['janvier','février','mars','avril','mai','juin','juillet','août','septembre','octobre','novembre','décembre'];
    const now = new Date();
    let m = now.getMonth();
    const monthNameEl = document.getElementById('month-name');
    const dayNumEl = document.getElementById('day-num');
    dayNumEl.value = now.getDate();
    monthNameEl.textContent = months[m];
    const prevDayBtn = document.getElementById('prev-day');
    const nextDayBtn = document.getElementById('next-day');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');

    function updateDateArrows() {
      if (m === now.getMonth()) {
        prevMonthBtn.classList.add('disabled');
      } else {
        prevMonthBtn.classList.remove('disabled');
      }
      if (m === now.getMonth() && parseInt(dayNumEl.value, 10) <= now.getDate()) {
        prevDayBtn.classList.add('disabled');
      } else {
        prevDayBtn.classList.remove('disabled');
      }
    }
    updateDateArrows();

    prevDayBtn.onclick = () => {
      let d = parseInt(dayNumEl.value, 10);
      if (m === now.getMonth() && d <= now.getDate()) return;
      dayNumEl.value = d > 1 ? d - 1 : 31;
      updateDateArrows();
    };
    nextDayBtn.onclick = () => {
      let d = parseInt(dayNumEl.value, 10);
      dayNumEl.value = d < 31 ? d + 1 : 1;
      updateDateArrows();
    };
    prevMonthBtn.onclick = () => {
      if (m === now.getMonth()) return;
      m = (m + 11) % 12;
      monthNameEl.textContent = months[m];
      updateDateArrows();
    };
    nextMonthBtn.onclick = () => {
      m = (m + 1) % 12;
      monthNameEl.textContent = months[m];
      updateDateArrows();
    };
    document.getElementById('arrow3').addEventListener('click', () => {
      reservation.date = `${dayNumEl.value} ${months[m]}`;
      next();
    });

    // Step4
    const controls4 = document.getElementById('controls4');
    document.querySelectorAll('#controls4 button').forEach(btn => btn.addEventListener('click', () => {
      Array.from(controls4.children).forEach(c => c.style.opacity = '0');
      btn.classList.add('selected');
      reservation.period = btn.dataset.value;
      setTimeout(next, 400);
    }));

    // Step5 times
    const c5 = document.getElementById('controls5');
    function loadTimes() {
      c5.innerHTML = '';
      let slots;
      let lastHour;
      if (reservation.period === 'Midi') {
        slots = [12,'30',13,'30',14,'30',15,'30',16,'30'];
        lastHour = 12;
      } else {
        slots = [17,'30',18,'30',19,'30',20,'30',21,'30',22,'30'];
        lastHour = 17;
      }
      slots.forEach(label => {
        const b = document.createElement('button');
        b.textContent = label;
        const time = label === '30'
          ? `${String(lastHour).padStart(2,'0')}:30`
          : `${String(label).padStart(2,'0')}:00`;
        if (label !== '30') lastHour = label;
        b.dataset.time = time;
        b.addEventListener('click', () => {
          Array.from(c5.children).forEach(ch => ch.style.opacity = '0');
          b.classList.add('selected');
          reservation.time = b.dataset.time;
          setTimeout(next, 400);
        });
        c5.appendChild(b);
      });
    }

    // Step6 name input
   let nameInit = false;
   function initNameStep() {
     const last = document.getElementById('lastname-input');
     const first = document.getElementById('firstname-input');
     if (!nameInit) {
       [last, first].forEach(el => { el.value = ''; });
       nameInit = true;
     }
     [last, first].forEach(el => { el.style.visibility = 'visible'; el.style.opacity = '1'; });
     last.focus();
     const arrow6 = document.getElementById('arrow6');
     arrow6.style.opacity = '1';
     arrow6.onclick = () => {
       reservation.lastname = last.value.trim();
       reservation.firstname = first.value.trim();
       [last, first].forEach(el => { el.style.opacity = '0'; el.style.visibility = 'hidden'; });
       next();
     };
   }


    // Step8 info input
    function initInfoStep() {
      const inEl = document.getElementById('info-input');
      const confirm = document.getElementById('arrow8');
      const ok = document.getElementById('okBtn');
      const typer = steps[8].querySelector('.typer');
      inEl.value = '';
      inEl.style.visibility = 'visible';
      inEl.style.opacity = '1';
      inEl.focus();
      confirm.style.opacity = '1';
      confirm.onclick = () => {
        reservation.comment = inEl.value.trim();
        confirm.style.opacity = '0';
        inEl.style.opacity = '0';
        inEl.style.visibility = 'hidden';
        typer.style.opacity = '0';
        updateBackButton();
        setTimeout(() => {
          ok.style.opacity = '1';
        }, 400);
        ok.onclick = () => {
          ok.style.opacity = '0';
          setTimeout(next, 400);
        };
      };
    }

    // Initialize
    document.getElementById('startBtn').addEventListener('click', () => {
      const b = document.getElementById('startBtn');
      b.classList.add('fade');
      setTimeout(() => { idx = 1; showStep(1); }, 400);
    });
    backBtn.addEventListener('click', () => {
      if (idx > 0) {
        resetStepData(idx);
        idx--;
        showStep(idx);
      }
    });
    showStep(0);
  </script>
</body>
</html>
